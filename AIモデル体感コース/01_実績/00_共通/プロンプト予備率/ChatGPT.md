# 🧭 TEPCO管内 OCCTO予備率予測モデル

## 特徴量設計・データ入手構造

---

## 1️⃣ 目的・スコープ

**目的:**  
TEPCO管内の電力需給データを基に、OCCTO公表値に準拠した「予備率（Reserve Margin）」を高精度に予測する。  
予測結果は、需給逼迫リスクの早期検知・供給計画支援・再エネ統合最適化に活用する。

**スコープ:**

- 地域：TEPCO（関東7都県＋山梨）管内
    
- 時間粒度：30分単位
    
- 対象期間：過去5年分（再エネ・気象・需給データ整合）
    
- モデル：LightGBMベース予測モデル
    

---

## 2️⃣ 特徴量カテゴリ構造

|区分|特徴量群|主な例|主目的|
|---|---|---|---|
|A. 需給実績|需要・供給・予備率（実績）|電力需要[kWh]、供給力、予備率（目的変数）|需給バランスの基礎系列|
|B. 電源構成|電源種別構成・点検状況|火力/水力/再エネ比率、定期点検停止予定|発電余力とリスク要因の把握|
|C. 再エネ出力|太陽光・風力出力|出力変動、出力制御量|供給変動性の特徴抽出|
|D. 気象要因|気温・湿度・日射・風速|気温=需要、日射=太陽光、風速=風力|需要・発電の同時影響要因|
|E. カレンダー|曜日・祝日・季節・時間帯|曜日区分、時間帯（ピーク/オフ）、祝日|消費パターンの周期性補正|
|F. 社会経済要因|景気・稼働率・料金単価|鉱工業生産指数、電気料金、契約数|中長期トレンド要因の補正|

---

## 3️⃣ データ入手構造（データソース体系）

|区分|データ名|入手元 / API / 公開機関|更新頻度|フォーマット|備考|
|---|---|---|---|---|---|
|電力需給|需給実績データ|OCCTO広域的運営推進機関|日次|CSV|30分単位需給・予備率|
|電力需給|TEPCO需給実績API|東京電力EP公式API|日次|JSON/CSV|地域別・時刻別|
|発電計画|電源構成・供給計画|OCCTO 年度計画報告|年次|Excel|燃料種別別構成比|
|発電計画|定期点検スケジュール|経産省 資源エネ庁|半年〜年次|PDF|火力停止期間反映|
|再エネ|太陽光出力・風力出力|OCCTO再エネ実績 / JEPX|日次|CSV|欠損多、補完要|
|気象|気温・湿度・日射・風速|気象庁 PastWeather API|日次|JSON/CSV|地点：関東7県平均|
|カレンダー|曜日・祝日|jpholiday / datetime|年次|内生成|祝日API連携可|
|経済|工業指数・電気料金|経産省統計・日銀統計|月次|CSV/XLS|長期補正用|

---

## 4️⃣ 特徴量生成構造（データ加工ロジック）

|フェーズ|処理内容|実装ポイント|
|---|---|---|
|① データ取得|各データソースからAPI/CSVで収集|Python `requests` + `pandas.read_csv`|
|② 前処理|欠損補完、単位統一、時系列結合|30分粒度、JST統一、線形補完|
|③ 特徴生成|時間帯・季節・移動平均・ラグ特徴|`shift()`, `rolling()` を活用|
|④ 統合|全データを需給実績に時刻基準で結合|`pd.merge_asof` による同期|
|⑤ 学習セット整形|`X (特徴量群)`、`y (予備率)`生成|`train_test_split` + LightGBM入力形式|
|⑥ 評価|検証用データでRMSE/MAE評価|`sklearn.metrics`活用|

---

## 5️⃣ モデル設計（概要）

|項目|内容|
|---|---|
|モデル種別|LightGBM 回帰モデル|
|入力特徴量|上記A〜Fカテゴリの全変数（約50特徴量）|
|目的変数|予備率（%）|
|評価指標|RMSE / MAE / MAPE|
|クロスバリデーション|時系列分割（TimeSeriesSplit）|
|重要特徴量分析|SHAP / Feature Importance|

---

## 6️⃣ 実務上の留意事項

- 🔹 TEPCO管内抽出：OCCTO地域コードをキーにフィルタ。
    
- 🔹 再エネデータ欠損：気象データ補完 or XGBoost回帰補完を推奨。
    
- 🔹 時系列一貫性：30分単位の欠損は線形補間ではなく前方補完が安定。
    
- 🔹 祝日・曜日効果：交互作用項（例：気温×曜日）を生成すると精度向上。
    
- 🔹 外れ値処理：需要・供給双方の異常スパイクをIQRで除去。
    

---

## 7️⃣ 推奨実装構成（開発視点）

```
/data/
  ├─ occto_demand.csv
  ├─ tepco_api_data.csv
  ├─ jma_weather.csv
  └─ metadata_calendar.csv
/src/
  ├─ 01_fetch_data.py     # データ取得
  ├─ 02_preprocess.py     # 前処理・結合
  ├─ 03_feature_engineer.py # 特徴生成
  ├─ 04_train_model.py    # LightGBM学習
  └─ 05_evaluate.py       # 評価・出力
/output/
  ├─ model.pkl
  ├─ feature_importance.png
  └─ evaluation_report.csv
```

---

## 8️⃣ 次フェーズ提案

| フェーズ    | 成果物           | ゴール                |
| ------- | ------------- | ------------------ |
| Phase 1 | 特徴量入手・統合スクリプト | TEPCO管内30分時系列データ整備 |
| Phase 2 | モデル学習・評価      | 精度 > 0.9 のRMSE比再現  |
| Phase 3 | ダッシュボード連携     | 予備率予測＋アラート自動化      |
